#!/usr/bin/env bash
# Usage: ./op <operation_name>
# This script resolves paths relative to its own location so you can run it from anywhere.

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CONFIG="${SCRIPT_DIR}/config.yml"
OPS="${SCRIPT_DIR}/operations.yml"

# Prefer local venv python if present, otherwise fallback to python3, then python.
PY_BIN="${SCRIPT_DIR}/.venv/bin/python"
if [ ! -x "${PY_BIN}" ]; then
  if command -v python3 >/dev/null 2>&1; then
    PY_BIN="python3"
  else
    PY_BIN="python"
  fi
fi

cd "${SCRIPT_DIR}"
"${PY_BIN}" -m app.run_op --config "${CONFIG}" --ops "${OPS}" --operation "$@"
